var pt=Object.defineProperty;var mt=(r,t,e)=>t in r?pt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var L=(r,t,e)=>mt(r,typeof t!="symbol"?t+"":t,e);import{L as $t,C as It,S as Le,a as b,b as Se,c as Rt,g as gt,d as we,l as Ne,D as vt,e as Lt}from"./index-Dw0VAJ3C.js";const St="transport";class k{constructor({context:t,logType:e}={}){L(this,"exchangeTimeout",3e4);L(this,"unresponsiveTimeout",15e3);L(this,"deviceModel",null);L(this,"tracer");L(this,"_events",new It);L(this,"send",async(t,e,s,i,a=Buffer.alloc(0),c=[Le.OK],{abortTimeoutMs:u}={})=>{const o=this.tracer.withUpdatedContext({function:"send"});if(a.length>=256)throw o.trace("data.length exceeded 256 bytes limit",{dataLength:a.length}),new b("data.length exceed 256 bytes limit. Got: "+a.length,"DataLengthTooBig");o.trace("Starting an exchange",{abortTimeoutMs:u});const I=await this.exchange(Buffer.concat([Buffer.from([t,e,s,i]),Buffer.from([a.length]),a]),{abortTimeoutMs:u});o.trace("Received response from exchange");const n=I.readUInt16BE(I.length-2);if(!c.some(E=>E===n))throw new Se(n);return I});L(this,"exchangeBusyPromise");L(this,"_appAPIlock",null);this.tracer=new $t(e??St,t)}exchange(t,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(t,e){let s=!1;const i=()=>{s=!0};return(async()=>{if(!s)for(const c of t){const u=await this.exchange(c);if(s)return;const o=u.readUInt16BE(u.length-2);if(o!==Le.OK)throw new Se(o);e.next(u)}})().then(()=>!s&&e.complete(),c=>!s&&e.error(c)),{unsubscribe:i}}setScrambleKey(t){}close(){return Promise.resolve()}on(t,e){this._events.on(t,e)}off(t,e){this._events.removeListener(t,e)}emit(t,...e){this._events.emit(t,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,e){return new Promise((s,i)=>{let a=!1;const c=this.listen({next:o=>{a=!0,c&&c.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,t).then(s,i)},error:o=>{u&&clearTimeout(u),i(o)},complete:()=>{u&&clearTimeout(u),a||i(new b(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{c.unsubscribe(),i(new b(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(t){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new Rt("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const i=new Promise(u=>{s=u});this.exchangeBusyPromise=i;let a=!1;const c=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),a=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await t();return a&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(c),s&&s(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(t,e,s){for(const i of e)t[i]=this.decorateAppAPIMethod(i,t[i],t,s)}decorateAppAPIMethod(t,e,s,i){return async(...a)=>{const{_appAPIlock:c}=this;if(c)return Promise.reject(new b("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(i),await e.apply(s,a)}finally{this._appAPIlock=null}}}setTraceContext(t){this.tracer=this.tracer.withContext(t)}updateTraceContext(t){this.tracer.updateContext(t)}getTraceContext(){return this.tracer.getContext()}}L(k,"isSupported"),L(k,"list"),L(k,"listen"),L(k,"open"),L(k,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),L(k,"ErrorMessage_NoDeviceFound","No Ledger device found");const Te=5;function wt(r){const t=Buffer.alloc(2);return t.writeUInt16BE(r,0),t}const Nt={data:Buffer.alloc(0),dataLength:0,sequence:0},Tt=(r,t)=>({makeBlocks(e){let s=Buffer.concat([wt(e.length),e]);const i=t-5,a=Math.ceil(s.length/i);s=Buffer.concat([s,Buffer.alloc(a*i-s.length+1).fill(0)]);const c=[];for(let u=0;u<a;u++){const o=Buffer.alloc(5);o.writeUInt16BE(r,0),o.writeUInt8(Te,2),o.writeUInt16BE(u,3);const I=s.slice(u*i,(u+1)*i);c.push(Buffer.concat([o,I]))}return c},reduceResponse(e,s){let{data:i,dataLength:a,sequence:c}=e||Nt;if(s.readUInt16BE(0)!==r)throw new b("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==Te)throw new b("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==c)throw new b("Invalid sequence","InvalidSequence");e||(a=s.readUInt16BE(5)),c++;const u=s.slice(e?5:7);return i=Buffer.concat([i,u]),i.length>a&&(i=i.slice(0,a)),{data:i,dataLength:a,sequence:c}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var fe={exports:{}};const Ot="2.0.0",Ze=256,At=Number.MAX_SAFE_INTEGER||9007199254740991,yt=16,Pt=Ze-6,xt=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var ee={MAX_LENGTH:Ze,MAX_SAFE_COMPONENT_LENGTH:yt,MAX_SAFE_BUILD_LENGTH:Pt,MAX_SAFE_INTEGER:At,RELEASE_TYPES:xt,SEMVER_SPEC_VERSION:Ot,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ie={};const Ct=typeof process=="object"&&ie&&ie.NODE_DEBUG&&/\bsemver\b/i.test(ie.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var te=Ct;(function(r,t){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=ee,a=te;t=r.exports={};const c=t.re=[],u=t.safeRe=[],o=t.src=[],I=t.safeSrc=[],n=t.t={};let E=0;const S="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",i],[S,s]],V=D=>{for(const[x,B]of p)D=D.split(`${x}*`).join(`${x}{0,${B}}`).split(`${x}+`).join(`${x}{1,${B}}`);return D},R=(D,x,B)=>{const A=V(x),G=E++;a(D,G,x),n[D]=G,o[G]=x,I[G]=A,c[G]=new RegExp(x,B?"g":void 0),u[G]=new RegExp(A,B?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*"),R("NUMERICIDENTIFIERLOOSE","\\d+"),R("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${S}*`),R("MAINVERSION",`(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})`),R("MAINVERSIONLOOSE",`(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASEIDENTIFIER",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIER]})`),R("PRERELEASEIDENTIFIERLOOSE",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIERLOOSE]})`),R("PRERELEASE",`(?:-(${o[n.PRERELEASEIDENTIFIER]}(?:\\.${o[n.PRERELEASEIDENTIFIER]})*))`),R("PRERELEASELOOSE",`(?:-?(${o[n.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[n.PRERELEASEIDENTIFIERLOOSE]})*))`),R("BUILDIDENTIFIER",`${S}+`),R("BUILD",`(?:\\+(${o[n.BUILDIDENTIFIER]}(?:\\.${o[n.BUILDIDENTIFIER]})*))`),R("FULLPLAIN",`v?${o[n.MAINVERSION]}${o[n.PRERELEASE]}?${o[n.BUILD]}?`),R("FULL",`^${o[n.FULLPLAIN]}$`),R("LOOSEPLAIN",`[v=\\s]*${o[n.MAINVERSIONLOOSE]}${o[n.PRERELEASELOOSE]}?${o[n.BUILD]}?`),R("LOOSE",`^${o[n.LOOSEPLAIN]}$`),R("GTLT","((?:<|>)?=?)"),R("XRANGEIDENTIFIERLOOSE",`${o[n.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),R("XRANGEIDENTIFIER",`${o[n.NUMERICIDENTIFIER]}|x|X|\\*`),R("XRANGEPLAIN",`[v=\\s]*(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:${o[n.PRERELEASE]})?${o[n.BUILD]}?)?)?`),R("XRANGEPLAINLOOSE",`[v=\\s]*(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:${o[n.PRERELEASELOOSE]})?${o[n.BUILD]}?)?)?`),R("XRANGE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAIN]}$`),R("XRANGELOOSE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAINLOOSE]}$`),R("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),R("COERCE",`${o[n.COERCEPLAIN]}(?:$|[^\\d])`),R("COERCEFULL",o[n.COERCEPLAIN]+`(?:${o[n.PRERELEASE]})?(?:${o[n.BUILD]})?(?:$|[^\\d])`),R("COERCERTL",o[n.COERCE],!0),R("COERCERTLFULL",o[n.COERCEFULL],!0),R("LONETILDE","(?:~>?)"),R("TILDETRIM",`(\\s*)${o[n.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",R("TILDE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAIN]}$`),R("TILDELOOSE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAINLOOSE]}$`),R("LONECARET","(?:\\^)"),R("CARETTRIM",`(\\s*)${o[n.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",R("CARET",`^${o[n.LONECARET]}${o[n.XRANGEPLAIN]}$`),R("CARETLOOSE",`^${o[n.LONECARET]}${o[n.XRANGEPLAINLOOSE]}$`),R("COMPARATORLOOSE",`^${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]})$|^$`),R("COMPARATOR",`^${o[n.GTLT]}\\s*(${o[n.FULLPLAIN]})$|^$`),R("COMPARATORTRIM",`(\\s*)${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]}|${o[n.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",R("HYPHENRANGE",`^\\s*(${o[n.XRANGEPLAIN]})\\s+-\\s+(${o[n.XRANGEPLAIN]})\\s*$`),R("HYPHENRANGELOOSE",`^\\s*(${o[n.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[n.XRANGEPLAINLOOSE]})\\s*$`),R("STAR","(<|>)?=?\\s*\\*"),R("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),R("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(fe,fe.exports);var q=fe.exports;const Ut=Object.freeze({loose:!0}),_t=Object.freeze({}),bt=r=>r?typeof r!="object"?Ut:r:_t;var Ee=bt;const Oe=/^[0-9]+$/,Je=(r,t)=>{const e=Oe.test(r),s=Oe.test(t);return e&&s&&(r=+r,t=+t),r===t?0:e&&!s?-1:s&&!e?1:r<t?-1:1},Dt=(r,t)=>Je(t,r);var Qe={compareIdentifiers:Je,rcompareIdentifiers:Dt};const H=te,{MAX_LENGTH:Ae,MAX_SAFE_INTEGER:Y}=ee,{safeRe:W,t:K}=q,Gt=Ee,{compareIdentifiers:X}=Qe;let Ft=class _{constructor(t,e){if(e=Gt(e),t instanceof _){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Ae)throw new TypeError(`version is longer than ${Ae} characters`);H("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const s=t.trim().match(e.loose?W[K.LOOSE]:W[K.FULL]);if(!s)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Y||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Y||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Y||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const a=+i;if(a>=0&&a<Y)return a}return i}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(H("SemVer.compare",this.version,this.options,t),!(t instanceof _)){if(typeof t=="string"&&t===this.version)return 0;t=new _(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof _||(t=new _(t,this.options)),X(this.major,t.major)||X(this.minor,t.minor)||X(this.patch,t.patch)}comparePre(t){if(t instanceof _||(t=new _(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const s=this.prerelease[e],i=t.prerelease[e];if(H("prerelease compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return X(s,i)}while(++e)}compareBuild(t){t instanceof _||(t=new _(t,this.options));let e=0;do{const s=this.build[e],i=t.build[e];if(H("build compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return X(s,i)}while(++e)}inc(t,e,s){if(t.startsWith("pre")){if(!e&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(e){const i=`-${e}`.match(this.options.loose?W[K.PRERELEASELOOSE]:W[K.PRERELEASE]);if(!i||i[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,s),this.inc("pre",e,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,s),this.inc("pre",e,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(e===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(e){let a=[e,i];s===!1&&(a=[e]),X(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var y=Ft;const ye=y,Bt=(r,t,e=!1)=>{if(r instanceof ye)return r;try{return new ye(r,t)}catch(s){if(!e)return null;throw s}};var j=Bt;const kt=j,Xt=(r,t)=>{const e=kt(r,t);return e?e.version:null};var jt=Xt;const Vt=j,Mt=(r,t)=>{const e=Vt(r.trim().replace(/^[=v]+/,""),t);return e?e.version:null};var zt=Mt;const Pe=y,qt=(r,t,e,s,i)=>{typeof e=="string"&&(i=s,s=e,e=void 0);try{return new Pe(r instanceof Pe?r.version:r,e).inc(t,s,i).version}catch{return null}};var Ht=qt;const xe=j,Yt=(r,t)=>{const e=xe(r,null,!0),s=xe(t,null,!0),i=e.compare(s);if(i===0)return null;const a=i>0,c=a?e:s,u=a?s:e,o=!!c.prerelease.length;if(!!u.prerelease.length&&!o){if(!u.patch&&!u.minor)return"major";if(u.compareMain(c)===0)return u.minor&&!u.patch?"minor":"patch"}const n=o?"pre":"";return e.major!==s.major?n+"major":e.minor!==s.minor?n+"minor":e.patch!==s.patch?n+"patch":"prerelease"};var Wt=Yt;const Kt=y,Zt=(r,t)=>new Kt(r,t).major;var Jt=Zt;const Qt=y,er=(r,t)=>new Qt(r,t).minor;var tr=er;const rr=y,sr=(r,t)=>new rr(r,t).patch;var nr=sr;const ir=j,or=(r,t)=>{const e=ir(r,t);return e&&e.prerelease.length?e.prerelease:null};var ar=or;const Ce=y,cr=(r,t,e)=>new Ce(r,e).compare(new Ce(t,e));var C=cr;const lr=C,ur=(r,t,e)=>lr(t,r,e);var fr=ur;const hr=C,dr=(r,t)=>hr(r,t,!0);var Er=dr;const Ue=y,pr=(r,t,e)=>{const s=new Ue(r,e),i=new Ue(t,e);return s.compare(i)||s.compareBuild(i)};var pe=pr;const mr=pe,$r=(r,t)=>r.sort((e,s)=>mr(e,s,t));var Ir=$r;const Rr=pe,gr=(r,t)=>r.sort((e,s)=>Rr(s,e,t));var vr=gr;const Lr=C,Sr=(r,t,e)=>Lr(r,t,e)>0;var re=Sr;const wr=C,Nr=(r,t,e)=>wr(r,t,e)<0;var me=Nr;const Tr=C,Or=(r,t,e)=>Tr(r,t,e)===0;var et=Or;const Ar=C,yr=(r,t,e)=>Ar(r,t,e)!==0;var tt=yr;const Pr=C,xr=(r,t,e)=>Pr(r,t,e)>=0;var $e=xr;const Cr=C,Ur=(r,t,e)=>Cr(r,t,e)<=0;var Ie=Ur;const _r=et,br=tt,Dr=re,Gr=$e,Fr=me,Br=Ie,kr=(r,t,e,s)=>{switch(t){case"===":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r===e;case"!==":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r!==e;case"":case"=":case"==":return _r(r,e,s);case"!=":return br(r,e,s);case">":return Dr(r,e,s);case">=":return Gr(r,e,s);case"<":return Fr(r,e,s);case"<=":return Br(r,e,s);default:throw new TypeError(`Invalid operator: ${t}`)}};var rt=kr;const Xr=y,jr=j,{safeRe:Z,t:J}=q,Vr=(r,t)=>{if(r instanceof Xr)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;t=t||{};let e=null;if(!t.rtl)e=r.match(t.includePrerelease?Z[J.COERCEFULL]:Z[J.COERCE]);else{const o=t.includePrerelease?Z[J.COERCERTLFULL]:Z[J.COERCERTL];let I;for(;(I=o.exec(r))&&(!e||e.index+e[0].length!==r.length);)(!e||I.index+I[0].length!==e.index+e[0].length)&&(e=I),o.lastIndex=I.index+I[1].length+I[2].length;o.lastIndex=-1}if(e===null)return null;const s=e[2],i=e[3]||"0",a=e[4]||"0",c=t.includePrerelease&&e[5]?`-${e[5]}`:"",u=t.includePrerelease&&e[6]?`+${e[6]}`:"";return jr(`${s}.${i}.${a}${c}${u}`,t)};var Mr=Vr;class zr{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);if(e!==void 0)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&e!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,e)}return this}}var qr=zr,oe,_e;function U(){if(_e)return oe;_e=1;const r=/\s+/g;class t{constructor(l,m){if(m=i(m),l instanceof t)return l.loose===!!m.loose&&l.includePrerelease===!!m.includePrerelease?l:new t(l.raw,m);if(l instanceof a)return this.raw=l.value,this.set=[[l]],this.formatted=void 0,this;if(this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease,this.raw=l.trim().replace(r," "),this.set=this.raw.split("||").map(h=>this.parseRange(h.trim())).filter(h=>h.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const h=this.set[0];if(this.set=this.set.filter($=>!R($[0])),this.set.length===0)this.set=[h];else if(this.set.length>1){for(const $ of this.set)if($.length===1&&D($[0])){this.set=[$];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let l=0;l<this.set.length;l++){l>0&&(this.formatted+="||");const m=this.set[l];for(let h=0;h<m.length;h++)h>0&&(this.formatted+=" "),this.formatted+=m[h].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(l){const h=((this.options.includePrerelease&&p)|(this.options.loose&&V))+":"+l,$=s.get(h);if($)return $;const d=this.options.loose,g=d?o[I.HYPHENRANGELOOSE]:o[I.HYPHENRANGE];l=l.replace(g,dt(this.options.includePrerelease)),c("hyphen replace",l),l=l.replace(o[I.COMPARATORTRIM],n),c("comparator trim",l),l=l.replace(o[I.TILDETRIM],E),c("tilde trim",l),l=l.replace(o[I.CARETTRIM],S),c("caret trim",l);let w=l.split(" ").map(O=>B(O,this.options)).join(" ").split(/\s+/).map(O=>ht(O,this.options));d&&(w=w.filter(O=>(c("loose invalid filter",O,this.options),!!O.match(o[I.COMPARATORLOOSE])))),c("range list",w);const v=new Map,N=w.map(O=>new a(O,this.options));for(const O of N){if(R(O))return[O];v.set(O.value,O)}v.size>1&&v.has("")&&v.delete("");const P=[...v.values()];return s.set(h,P),P}intersects(l,m){if(!(l instanceof t))throw new TypeError("a Range is required");return this.set.some(h=>x(h,m)&&l.set.some($=>x($,m)&&h.every(d=>$.every(g=>d.intersects(g,m)))))}test(l){if(!l)return!1;if(typeof l=="string")try{l=new u(l,this.options)}catch{return!1}for(let m=0;m<this.set.length;m++)if(Et(this.set[m],l,this.options))return!0;return!1}}oe=t;const e=qr,s=new e,i=Ee,a=se(),c=te,u=y,{safeRe:o,t:I,comparatorTrimReplace:n,tildeTrimReplace:E,caretTrimReplace:S}=q,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:V}=ee,R=f=>f.value==="<0.0.0-0",D=f=>f.value==="",x=(f,l)=>{let m=!0;const h=f.slice();let $=h.pop();for(;m&&h.length;)m=h.every(d=>$.intersects(d,l)),$=h.pop();return m},B=(f,l)=>(c("comp",f,l),f=at(f,l),c("caret",f),f=G(f,l),c("tildes",f),f=lt(f,l),c("xrange",f),f=ft(f,l),c("stars",f),f),A=f=>!f||f.toLowerCase()==="x"||f==="*",G=(f,l)=>f.trim().split(/\s+/).map(m=>ot(m,l)).join(" "),ot=(f,l)=>{const m=l.loose?o[I.TILDELOOSE]:o[I.TILDE];return f.replace(m,(h,$,d,g,w)=>{c("tilde",f,h,$,d,g,w);let v;return A($)?v="":A(d)?v=`>=${$}.0.0 <${+$+1}.0.0-0`:A(g)?v=`>=${$}.${d}.0 <${$}.${+d+1}.0-0`:w?(c("replaceTilde pr",w),v=`>=${$}.${d}.${g}-${w} <${$}.${+d+1}.0-0`):v=`>=${$}.${d}.${g} <${$}.${+d+1}.0-0`,c("tilde return",v),v})},at=(f,l)=>f.trim().split(/\s+/).map(m=>ct(m,l)).join(" "),ct=(f,l)=>{c("caret",f,l);const m=l.loose?o[I.CARETLOOSE]:o[I.CARET],h=l.includePrerelease?"-0":"";return f.replace(m,($,d,g,w,v)=>{c("caret",f,$,d,g,w,v);let N;return A(d)?N="":A(g)?N=`>=${d}.0.0${h} <${+d+1}.0.0-0`:A(w)?d==="0"?N=`>=${d}.${g}.0${h} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.0${h} <${+d+1}.0.0-0`:v?(c("replaceCaret pr",v),d==="0"?g==="0"?N=`>=${d}.${g}.${w}-${v} <${d}.${g}.${+w+1}-0`:N=`>=${d}.${g}.${w}-${v} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.${w}-${v} <${+d+1}.0.0-0`):(c("no pr"),d==="0"?g==="0"?N=`>=${d}.${g}.${w}${h} <${d}.${g}.${+w+1}-0`:N=`>=${d}.${g}.${w}${h} <${d}.${+g+1}.0-0`:N=`>=${d}.${g}.${w} <${+d+1}.0.0-0`),c("caret return",N),N})},lt=(f,l)=>(c("replaceXRanges",f,l),f.split(/\s+/).map(m=>ut(m,l)).join(" ")),ut=(f,l)=>{f=f.trim();const m=l.loose?o[I.XRANGELOOSE]:o[I.XRANGE];return f.replace(m,(h,$,d,g,w,v)=>{c("xRange",f,h,$,d,g,w,v);const N=A(d),P=N||A(g),O=P||A(w),M=O;return $==="="&&M&&($=""),v=l.includePrerelease?"-0":"",N?$===">"||$==="<"?h="<0.0.0-0":h="*":$&&M?(P&&(g=0),w=0,$===">"?($=">=",P?(d=+d+1,g=0,w=0):(g=+g+1,w=0)):$==="<="&&($="<",P?d=+d+1:g=+g+1),$==="<"&&(v="-0"),h=`${$+d}.${g}.${w}${v}`):P?h=`>=${d}.0.0${v} <${+d+1}.0.0-0`:O&&(h=`>=${d}.${g}.0${v} <${d}.${+g+1}.0-0`),c("xRange return",h),h})},ft=(f,l)=>(c("replaceStars",f,l),f.trim().replace(o[I.STAR],"")),ht=(f,l)=>(c("replaceGTE0",f,l),f.trim().replace(o[l.includePrerelease?I.GTE0PRE:I.GTE0],"")),dt=f=>(l,m,h,$,d,g,w,v,N,P,O,M)=>(A(h)?m="":A($)?m=`>=${h}.0.0${f?"-0":""}`:A(d)?m=`>=${h}.${$}.0${f?"-0":""}`:g?m=`>=${m}`:m=`>=${m}${f?"-0":""}`,A(N)?v="":A(P)?v=`<${+N+1}.0.0-0`:A(O)?v=`<${N}.${+P+1}.0-0`:M?v=`<=${N}.${P}.${O}-${M}`:f?v=`<${N}.${P}.${+O+1}-0`:v=`<=${v}`,`${m} ${v}`.trim()),Et=(f,l,m)=>{for(let h=0;h<f.length;h++)if(!f[h].test(l))return!1;if(l.prerelease.length&&!m.includePrerelease){for(let h=0;h<f.length;h++)if(c(f[h].semver),f[h].semver!==a.ANY&&f[h].semver.prerelease.length>0){const $=f[h].semver;if($.major===l.major&&$.minor===l.minor&&$.patch===l.patch)return!0}return!1}return!0};return oe}var ae,be;function se(){if(be)return ae;be=1;const r=Symbol("SemVer ANY");class t{static get ANY(){return r}constructor(n,E){if(E=e(E),n instanceof t){if(n.loose===!!E.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),c("comparator",n,E),this.options=E,this.loose=!!E.loose,this.parse(n),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(n){const E=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR],S=n.match(E);if(!S)throw new TypeError(`Invalid comparator: ${n}`);this.operator=S[1]!==void 0?S[1]:"",this.operator==="="&&(this.operator=""),S[2]?this.semver=new u(S[2],this.options.loose):this.semver=r}toString(){return this.value}test(n){if(c("Comparator.test",n,this.options.loose),this.semver===r||n===r)return!0;if(typeof n=="string")try{n=new u(n,this.options)}catch{return!1}return a(n,this.operator,this.semver,this.options)}intersects(n,E){if(!(n instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(n.value,E).test(this.value):n.operator===""?n.value===""?!0:new o(this.value,E).test(n.semver):(E=e(E),E.includePrerelease&&(this.value==="<0.0.0-0"||n.value==="<0.0.0-0")||!E.includePrerelease&&(this.value.startsWith("<0.0.0")||n.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&n.operator.startsWith(">")||this.operator.startsWith("<")&&n.operator.startsWith("<")||this.semver.version===n.semver.version&&this.operator.includes("=")&&n.operator.includes("=")||a(this.semver,"<",n.semver,E)&&this.operator.startsWith(">")&&n.operator.startsWith("<")||a(this.semver,">",n.semver,E)&&this.operator.startsWith("<")&&n.operator.startsWith(">")))}}ae=t;const e=Ee,{safeRe:s,t:i}=q,a=rt,c=te,u=y,o=U();return ae}const Hr=U(),Yr=(r,t,e)=>{try{t=new Hr(t,e)}catch{return!1}return t.test(r)};var ne=Yr;const Wr=U(),Kr=(r,t)=>new Wr(r,t).set.map(e=>e.map(s=>s.value).join(" ").trim().split(" "));var Zr=Kr;const Jr=y,Qr=U(),es=(r,t,e)=>{let s=null,i=null,a=null;try{a=new Qr(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===-1)&&(s=c,i=new Jr(s,e))}),s};var ts=es;const rs=y,ss=U(),ns=(r,t,e)=>{let s=null,i=null,a=null;try{a=new ss(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===1)&&(s=c,i=new rs(s,e))}),s};var is=ns;const ce=y,os=U(),De=re,as=(r,t)=>{r=new os(r,t);let e=new ce("0.0.0");if(r.test(e)||(e=new ce("0.0.0-0"),r.test(e)))return e;e=null;for(let s=0;s<r.set.length;++s){const i=r.set[s];let a=null;i.forEach(c=>{const u=new ce(c.semver.version);switch(c.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!a||De(u,a))&&(a=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),a&&(!e||De(e,a))&&(e=a)}return e&&r.test(e)?e:null};var cs=as;const ls=U(),us=(r,t)=>{try{return new ls(r,t).range||"*"}catch{return null}};var fs=us;const hs=y,st=se(),{ANY:ds}=st,Es=U(),ps=ne,Ge=re,Fe=me,ms=Ie,$s=$e,Is=(r,t,e,s)=>{r=new hs(r,s),t=new Es(t,s);let i,a,c,u,o;switch(e){case">":i=Ge,a=ms,c=Fe,u=">",o=">=";break;case"<":i=Fe,a=$s,c=Ge,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ps(r,t,s))return!1;for(let I=0;I<t.set.length;++I){const n=t.set[I];let E=null,S=null;if(n.forEach(p=>{p.semver===ds&&(p=new st(">=0.0.0")),E=E||p,S=S||p,i(p.semver,E.semver,s)?E=p:c(p.semver,S.semver,s)&&(S=p)}),E.operator===u||E.operator===o||(!S.operator||S.operator===u)&&a(r,S.semver))return!1;if(S.operator===o&&c(r,S.semver))return!1}return!0};var Re=Is;const Rs=Re,gs=(r,t,e)=>Rs(r,t,">",e);var vs=gs;const Ls=Re,Ss=(r,t,e)=>Ls(r,t,"<",e);var ws=Ss;const Be=U(),Ns=(r,t,e)=>(r=new Be(r,e),t=new Be(t,e),r.intersects(t,e));var Ts=Ns;const Os=ne,As=C;var ys=(r,t,e)=>{const s=[];let i=null,a=null;const c=r.sort((n,E)=>As(n,E,e));for(const n of c)Os(n,t,e)?(a=n,i||(i=n)):(a&&s.push([i,a]),a=null,i=null);i&&s.push([i,null]);const u=[];for(const[n,E]of s)n===E?u.push(n):!E&&n===c[0]?u.push("*"):E?n===c[0]?u.push(`<=${E}`):u.push(`${n} - ${E}`):u.push(`>=${n}`);const o=u.join(" || "),I=typeof t.raw=="string"?t.raw:String(t);return o.length<I.length?o:t};const ke=U(),ge=se(),{ANY:le}=ge,z=ne,ve=C,Ps=(r,t,e={})=>{if(r===t)return!0;r=new ke(r,e),t=new ke(t,e);let s=!1;e:for(const i of r.set){for(const a of t.set){const c=Cs(i,a,e);if(s=s||c!==null,c)continue e}if(s)return!1}return!0},xs=[new ge(">=0.0.0-0")],Xe=[new ge(">=0.0.0")],Cs=(r,t,e)=>{if(r===t)return!0;if(r.length===1&&r[0].semver===le){if(t.length===1&&t[0].semver===le)return!0;e.includePrerelease?r=xs:r=Xe}if(t.length===1&&t[0].semver===le){if(e.includePrerelease)return!0;t=Xe}const s=new Set;let i,a;for(const p of r)p.operator===">"||p.operator===">="?i=je(i,p,e):p.operator==="<"||p.operator==="<="?a=Ve(a,p,e):s.add(p.semver);if(s.size>1)return null;let c;if(i&&a){if(c=ve(i.semver,a.semver,e),c>0)return null;if(c===0&&(i.operator!==">="||a.operator!=="<="))return null}for(const p of s){if(i&&!z(p,String(i),e)||a&&!z(p,String(a),e))return null;for(const V of t)if(!z(p,String(V),e))return!1;return!0}let u,o,I,n,E=a&&!e.includePrerelease&&a.semver.prerelease.length?a.semver:!1,S=i&&!e.includePrerelease&&i.semver.prerelease.length?i.semver:!1;E&&E.prerelease.length===1&&a.operator==="<"&&E.prerelease[0]===0&&(E=!1);for(const p of t){if(n=n||p.operator===">"||p.operator===">=",I=I||p.operator==="<"||p.operator==="<=",i){if(S&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===S.major&&p.semver.minor===S.minor&&p.semver.patch===S.patch&&(S=!1),p.operator===">"||p.operator===">="){if(u=je(i,p,e),u===p&&u!==i)return!1}else if(i.operator===">="&&!z(i.semver,String(p),e))return!1}if(a){if(E&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===E.major&&p.semver.minor===E.minor&&p.semver.patch===E.patch&&(E=!1),p.operator==="<"||p.operator==="<="){if(o=Ve(a,p,e),o===p&&o!==a)return!1}else if(a.operator==="<="&&!z(a.semver,String(p),e))return!1}if(!p.operator&&(a||i)&&c!==0)return!1}return!(i&&I&&!a&&c!==0||a&&n&&!i&&c!==0||S||E)},je=(r,t,e)=>{if(!r)return t;const s=ve(r.semver,t.semver,e);return s>0?r:s<0||t.operator===">"&&r.operator===">="?t:r},Ve=(r,t,e)=>{if(!r)return t;const s=ve(r.semver,t.semver,e);return s<0?r:s>0||t.operator==="<"&&r.operator==="<="?t:r};var Us=Ps;const ue=q,Me=ee,_s=y,ze=Qe,bs=j,Ds=jt,Gs=zt,Fs=Ht,Bs=Wt,ks=Jt,Xs=tr,js=nr,Vs=ar,Ms=C,zs=fr,qs=Er,Hs=pe,Ys=Ir,Ws=vr,Ks=re,Zs=me,Js=et,Qs=tt,en=$e,tn=Ie,rn=rt,sn=Mr,nn=se(),on=U(),an=ne,cn=Zr,ln=ts,un=is,fn=cs,hn=fs,dn=Re,En=vs,pn=ws,mn=Ts,$n=ys,In=Us;var Rn={parse:bs,valid:Ds,clean:Gs,inc:Fs,diff:Bs,major:ks,minor:Xs,patch:js,prerelease:Vs,compare:Ms,rcompare:zs,compareLoose:qs,compareBuild:Hs,sort:Ys,rsort:Ws,gt:Ks,lt:Zs,eq:Js,neq:Qs,gte:en,lte:tn,cmp:rn,coerce:sn,Comparator:nn,Range:on,satisfies:an,toComparators:cn,maxSatisfying:ln,minSatisfying:un,minVersion:fn,validRange:hn,outside:dn,gtr:En,ltr:pn,intersects:mn,simplifyRange:$n,subset:In,SemVer:_s,re:ue.re,src:ue.src,tokens:ue.t,SEMVER_SPEC_VERSION:Me.SEMVER_SPEC_VERSION,RELEASE_TYPES:Me.RELEASE_TYPES,compareIdentifiers:ze.compareIdentifiers,rcompareIdentifiers:ze.rcompareIdentifiers};const qe=gt(Rn);var T;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa",r.apex="apex"})(T||(T={}));const he={[T.blue]:{id:T.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[T.nanoS]:{id:T.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>qe.lt(qe.coerce(r)??"","2.0.0")?4*1024:2*1024},[T.nanoX]:{id:T.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[T.nanoSP]:{id:T.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[T.apex]:{id:T.apex,productName:"Ledger Apex",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1533*1024,masks:[859832320],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[T.stax]:{id:T.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[T.europa]:{id:T.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};T.blue,T.nanoS,T.nanoSP,T.nanoX,T.stax,T.europa;const He=Object.values(he),nt=11415,Ye=r=>{const t=He.find(i=>i.legacyUsbProductId===r);if(t)return t;const e=r>>8;return He.find(i=>i.productIdMM===e)},gn=[],We={};for(const r in he){const t=he[r],{bluetoothSpec:e}=t;if(e)for(let s=0;s<e.length;s++){const i=e[s];gn.push(i.serviceUuid),We[i.serviceUuid]=We[i.serviceUuid.replace(/-/g,"")]={deviceModel:t,...i}}}const vn=[{vendorId:nt}],Ln=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),Q=()=>{const{hid:r}=navigator;if(!r)throw new b("navigator.hid is not supported","HIDNotSupported");return r};async function it(){const r=await Q().requestDevice({filters:vn});return Array.isArray(r)?r:[r]}async function de(){return(await Q().getDevices()).filter(t=>t.vendorId===nt)}async function Sn(){const r=await de();return r.length>0?r[0]:(await it())[0]}const F=class F extends k{constructor(e){super();L(this,"device");L(this,"deviceModel");L(this,"channel",Math.floor(Math.random()*65535));L(this,"packetSize",64);L(this,"inputs",[]);L(this,"inputCallback");L(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));L(this,"onInputReport",e=>{const s=Buffer.from(e.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)});L(this,"_disconnectEmitted",!1);L(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});L(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:i,packetSize:a}=this;Ne("apdu","=> "+e.toString("hex"));const c=Tt(i,a),u=c.makeBlocks(e);for(let n=0;n<u.length;n++)await this.device.sendReport(0,u[n]);let o,I;for(;!(o=c.getReducedResult(I));)try{const n=await this.read();I=c.reduceResponse(I,n)}catch(n){if(n instanceof b&&n.id==="InvalidChannel")continue;throw n}return Ne("apdu","<= "+o.toString("hex")),o}).catch(i=>{throw i&&i.message&&i.message.includes("write")?(this._emitDisconnect(i),new vt(i.message)):i}));this.device=e,this.deviceModel=typeof e.productId=="number"?Ye(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await it();return F.open(e)}static async openConnected(){const e=await de();return e.length===0?null:F.open(e[0])}static async open(e){await e.open();const s=new F(e),i=a=>{e===a.device&&(Q().removeEventListener("disconnect",i),s._emitDisconnect(new Lt))};return Q().addEventListener("disconnect",i),s}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};L(F,"isSupported",Ln),L(F,"list",de),L(F,"listen",e=>{let s=!1;Sn().then(a=>{if(!a)e.error(new we("Access denied to use Ledger device"));else if(!s){const c=typeof a.productId=="number"?Ye(a.productId):void 0;e.next({type:"add",descriptor:a,deviceModel:c}),e.complete()}},a=>{e.error(new we(a.message))});function i(){s=!0}return{unsubscribe:i}});let Ke=F;export{Ke as default};
